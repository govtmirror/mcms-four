<!--
@license
Copyright (c) 2015 dean wagner wagner@nmb.gov. All rights reserved.
-->

<dom-module id="mcms-activitylist">

  <style>
    :host {
      display: block;
      box-sizing: border-box;   
    }

    .backlist {
      @apply(--paper-font-display1);
      color: var(--primary-text-color);
      background-color: var(--light-primary-color);
      margin:10px;
      padding:10px;
      border-radius: 10px; 
    }

  </style>

  <template>

    <div class="backlist">
      <h3>{{_showCaseID(selectedCase.caseID)}}</h3>

      <template is="dom-repeat" 
          items="{{selectedActivities}}"
          filter="_hasCase"
          sort="_reverseSort"
          id="actlist">
        <mcms-activity activity="{{item}}">
        </mcms-activity>
      </template>

    </div>
  </template>

  <script>

    Polymer({

      is: 'mcms-activitylist',

      properties: {
        selectedActivities: Array,
        selectedCase: {
          type: Object,
          value: function () {
            return {};
          }
        }
      },

      redrawit: function () {
        this.$.actlist.render();
      },

      _hasCase: function (item) {
        if (this.selectedCase != null){
          var teststring = this.selectedCase.caseID;
          if (teststring) {
            var testresult = false;
            var testObject = item.cases;
            for (var prop in testObject) {
              if (!testObject.hasOwnProperty(prop)) {
                continue;
              }
              if (testObject[prop].startsWith(teststring)) {
                testresult = true;
              }
            }
            return testresult;
          } else {
            return false;
          } 
        } else {
          return false;
        }
        
      },

      _showCaseID: function () {
        if (this.selectedCase) {
          if (this.selectedCase.hasOwnProperty('caseID')) {
            return this.selectedCase.caseID;
          } else {
            return "no case selected"
          }
        } else {
          return "no case selected"
        }
      },

      _reverseSort: function (a, b) {
        var aa = parseInt(a.activityDate);
        var bb = parseInt(b.activityDate);
        return bb - aa;
      }

    });

  </script>
</dom-module>